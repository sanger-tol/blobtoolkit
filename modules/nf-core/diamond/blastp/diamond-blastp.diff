Changes in component 'nf-core/diamond/blastp'
'modules/nf-core/diamond/blastp/meta.yml' is unchanged
'modules/nf-core/diamond/blastp/environment.yml' is unchanged
Changes in 'diamond/blastp/main.nf':
--- modules/nf-core/diamond/blastp/main.nf
+++ modules/nf-core/diamond/blastp/main.nf
@@ -12,6 +12,7 @@
     tuple val(meta2), path(db)
     val out_ext
     val blast_columns
+    val taxid
 
     output:
     tuple val(meta), path('*.blast'), optional: true, emit: blast
@@ -32,6 +33,7 @@
     def is_compressed = fasta.getExtension() == "gz" ? true : false
     def fasta_name = is_compressed ? fasta.getBaseName() : fasta
     def columns = blast_columns ? "${blast_columns}" : ''
+    def exclude_taxon = taxid ? "--taxon-exclude ${taxid}" : ''
     switch ( out_ext ) {
         case "blast": outfmt = 0; break
         case "xml": outfmt = 5; break
@@ -46,10 +48,16 @@
             log.warn("Unknown output file format provided (${out_ext}): selecting DIAMOND default of tabular BLAST output (txt)");
             break
     }
+
+    def tmpdir_arg  = args =~ /--tmpdir\s+(\S+)/
+    def tmpdir      = tmpdir_arg ? tmpdir_arg[0][1] : ''
+
     """
     if [ "${is_compressed}" == "true" ]; then
         gzip -c -d ${fasta} > ${fasta_name}
     fi
+
+    ${tmpdir ? "mkdir -p ${tmpdir}" : ''}
 
     DB=`find -L ./ -name "*.dmnd" | sed 's/\\.dmnd\$//'`
 
@@ -59,6 +67,7 @@
         --db \$DB \\
         --query ${fasta_name} \\
         --outfmt ${outfmt} ${columns} \\
+        ${exclude_taxon} \\
         ${args} \\
         --out ${prefix}.${out_ext}
 

'modules/nf-core/diamond/blastp/tests/main.nf.test' is unchanged
'modules/nf-core/diamond/blastp/tests/main.nf.test.snap' is unchanged
'modules/nf-core/diamond/blastp/tests/tags.yml' is unchanged
************************************************************
